---
import PropertyDetails from "@/components/astro/PropertyDetails.astro";
import { db, Properties, PropertiesImages, asc } from "astro:db";

export async function getStaticPaths() {
  // Obtener todas las propiedades
  const allProperties = await db.select().from(Properties);
  
  // Obtener todas las imágenes
  const allImages = await db
    .select()
    .from(PropertiesImages)
    .orderBy(asc(PropertiesImages.order));

  // Agrupar imágenes por propertyId
  const imagesByProperty = allImages.reduce((acc, img) => {
    if (!acc[img.propertyId]) {
      acc[img.propertyId] = [];
    }
    acc[img.propertyId].push(img);
    return acc;
  }, {} as Record<string, typeof allImages>);

  // Crear paths con propiedades e imágenes
  return allProperties.map((p) => ({
    params: { slug: p.slug },
    props: { 
      property: {
        ...p,
        images: imagesByProperty[p.id] || []
      }
    },
  }));
}

const { property } = Astro.props;
---
<div>
  <PropertyDetails property={property} />
</div>





<!-- SSG -->

<!-- ---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import listings from '@/data/properties.json';  
import PropertyDetails from "@/components/astro/PropertyDetails.astro";

// retrieve all listings from the json data
export const getStaticPaths: GetStaticPaths = async () => {
  return listings.map((listing) => ({
    params: { slug: listing.slug },
    props: { listing },
  }));
};  

// Desestructura la propiedad individual
const { listing } = Astro.props;
---

<div>

  <PropertyDetails property={listing} />
</div> -->
