---
import PropertyDetails from "@/components/astro/PropertyDetails.astro";
import { db, Properties, Categories, PropertyCategories, PropertiesImages, eq } from "astro:db";

export async function getStaticPaths() {
  // obtener todos los slugs desde Astro DB
  const all = await db.select().from(Properties);

  return all.map((p) => ({
    params: { slug: p.slug },
    props: { property: p }, // se envía al componente
  }));
}

const { property } = Astro.props;

// Obtener categorías de la propiedad
const propertyCategories = await db
  .select({
    id: Categories.id,
    name: Categories.name,
    slug: Categories.slug,
    icon: Categories.icon,
  })
  .from(PropertyCategories)
  .innerJoin(Categories, eq(PropertyCategories.categoryId, Categories.id))
  .where(eq(PropertyCategories.propertyId, property.id))
  .all();

// Obtener imágenes de la propiedad
const propertyImages = await db
  .select()
  .from(PropertiesImages)
  .where(eq(PropertiesImages.propertyId, property.id))
  .all();
---
<div>
  <PropertyDetails property={property} categories={propertyCategories} images={propertyImages} />
</div>





<!-- SSG -->

<!-- ---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import listings from '@/data/properties.json';  
import PropertyDetails from "@/components/astro/PropertyDetails.astro";

// retrieve all listings from the json data
export const getStaticPaths: GetStaticPaths = async () => {
  return listings.map((listing) => ({
    params: { slug: listing.slug },
    props: { listing },
  }));
};  

// Desestructura la propiedad individual
const { listing } = Astro.props;
---

<div>

  <PropertyDetails property={listing} />
</div> -->
